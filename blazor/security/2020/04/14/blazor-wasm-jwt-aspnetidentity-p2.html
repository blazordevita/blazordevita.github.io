<!DOCTYPE html>
<html lang="it"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/icon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/icon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/icon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/icon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/icon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/icon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/icon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/icon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/icon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/icon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/icon/favicon-16x16.png">
    <link rel="manifest" href="/assets/icon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Autenticazione JWT e ASP.NET Identity in Blazor - Parte 2 | Blazor Developer Italiani</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Autenticazione JWT e ASP.NET Identity in Blazor - Parte 2" />
<meta name="author" content="Gianluca Gentile" />
<meta property="og:locale" content="it" />
<meta name="description" content="Entriamo nel vivo della fase di registrazione dell’utente, completando il processo di creazione e di convalida dell’account. Per fare ciò andiamo a creare il controller che si occuperà della registrazione e di altre funzionalità che riguardano l’utente." />
<meta property="og:description" content="Entriamo nel vivo della fase di registrazione dell’utente, completando il processo di creazione e di convalida dell’account. Per fare ciò andiamo a creare il controller che si occuperà della registrazione e di altre funzionalità che riguardano l’utente." />
<link rel="canonical" href="/blazor/security/2020/04/14/blazor-wasm-jwt-aspnetidentity-p2.html" />
<meta property="og:url" content="/blazor/security/2020/04/14/blazor-wasm-jwt-aspnetidentity-p2.html" />
<meta property="og:site_name" content="Blazor Developer Italiani" />
<meta property="og:image" content="/assets/articoli/blazor-wasm-jwt-aspnetidentity-p2/blazor-wasm-jwt-aspnetidentity-p2.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-04-14T01:00:00+02:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"/blazor/security/2020/04/14/blazor-wasm-jwt-aspnetidentity-p2.html"},"image":"/assets/articoli/blazor-wasm-jwt-aspnetidentity-p2/blazor-wasm-jwt-aspnetidentity-p2.png","author":{"@type":"Person","name":"Gianluca Gentile"},"description":"Entriamo nel vivo della fase di registrazione dell’utente, completando il processo di creazione e di convalida dell’account. Per fare ciò andiamo a creare il controller che si occuperà della registrazione e di altre funzionalità che riguardano l’utente.","url":"/blazor/security/2020/04/14/blazor-wasm-jwt-aspnetidentity-p2.html","@type":"BlogPosting","headline":"Autenticazione JWT e ASP.NET Identity in Blazor - Parte 2","dateModified":"2020-04-14T01:00:00+02:00","datePublished":"2020-04-14T01:00:00+02:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/site.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Blazor Developer Italiani" /><script async src="https://www.googletagmanager.com/gtag/js?id="></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55415192-2"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-55415192-2');
    </script>
</head><body><header class="site-header">

    <div class="wrapper"><img class="logo" src="/assets/img/blazordevita_logo.png" alt="logo blazor developer italiani" />
      <a class="site-title" rel="author" href="/">Blazor Developer Italiani</a><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
              </svg>
            </span>
          </label>
  
          <div class="trigger"><a class="page-link" href="/chisiamo/">Chi Siamo</a><a class="page-link" href="/articoli/">Articoli</a><a class="page-link" href="/eventi/">Eventi</a><a class="page-link" href="/sponsor/">Sponsor</a></div>
        </nav></div>
  </header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h3 class="post-subtitle">Autenticazione e sicurezza in Blazor WASM</h3>
    <h1 class="post-title p-name" itemprop="name headline">Autenticazione JWT e ASP.NET Identity in Blazor - Parte 2</h1>
    <h4>Data pubblicazione: 14-04-2020 - Autore: Gianluca Gentile</h4>
  </header><figure>
      <img src="/assets/articoli/blazor-wasm-jwt-aspnetidentity-p2/blazor-wasm-jwt-aspnetidentity-p2.png" alt="Autenticazione JWT e ASP.NET Identity in Blazor - Parte 2" />
  </figure><div class="post-content e-content" itemprop="articleBody">
    <p>Entriamo nel vivo della fase di registrazione dell’utente, completando il processo di creazione e di convalida dell’account. Per fare ciò andiamo a creare il controller che si occuperà della registrazione e di altre funzionalità che riguardano l’utente.</p>

<h2 id="email-service">Email service</h2>
<p>Qualsiasi applicazione web necessita di inviare e-mail quindi, prima di andare a scrivere la logica di gestione dell’utente, occupiamoci di fare il setup del nostro servizio e-mail. Per questo servizio ho creato un’interfaccia (nella cartella <code class="highlighter-rouge">Interfaces</code>) che riporta il seguente codice:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="nc">IEmailSender</span>
<span class="p">{</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="n">MailAddress</span><span class="p">&gt;</span> <span class="nf">GetEmailList</span><span class="p">(</span><span class="kt">string</span> <span class="n">emails</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="nf">IsValidEmail</span><span class="p">(</span><span class="kt">string</span> <span class="n">email</span><span class="p">);</span>
    <span class="n">Task</span><span class="p">&lt;</span><span class="kt">bool</span><span class="p">&gt;</span> <span class="nf">SendMail</span><span class="p">(</span><span class="kt">string</span> <span class="n">To</span><span class="p">,</span> <span class="kt">string</span> <span class="n">Subject</span><span class="p">,</span> <span class="kt">string</span> <span class="n">Body</span><span class="p">,</span> <span class="kt">string</span> <span class="n">Allegati</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="kt">string</span> <span class="n">Cc</span> <span class="p">=</span> <span class="k">null</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>Inoltre, dato che carico la configurazione per l’SMTP dal file appsettings.json, ho pensato di creato una classe di opzioni denominata <code class="highlighter-rouge">EmailSenderOption</code>, il cui contenuto è il seguente:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">EmailSenderOption</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">From</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsAuthenticate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Username</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Password</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Host</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">SSL</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Port</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsBodyHTML</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Bcc</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Dentro il file appsettings.json ho aggiunto questa nuova configurazione a quelle presenti:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="nl">"EmailSenderOption"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"From"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email@mittente.it"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"IsAuthenticate"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email@mittente.it"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"passwordSegretissima205920!"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mail.server.it"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"SSL"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Port"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w">
    </span><span class="nl">"IsBodyHTML"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Bcc"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>Nel progetto “Server” quindi abbiamo questa nuova struttura:</p>

<p><img src="/assets/articoli/blazor-wasm-jwt-aspnetidentity-p2/image001.png" alt="Struttura progetto aggiornata" /></p>

<p>Non resta che aggiungere al file Startup.cs il nuovo servizio:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">services</span><span class="p">.</span><span class="n">Configure</span><span class="p">&lt;</span><span class="n">EmailSenderOption</span><span class="p">&gt;(</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetSection</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">EmailSenderOption</span><span class="p">)));</span>
<span class="n">services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">IEmailSender</span><span class="p">,</span> <span class="n">EmailSenderService</span><span class="p">&gt;();</span></code></pre></figure>

<h2 id="account-controller">Account controller</h2>
<p>Cliccando con il tasto destro della cartella denominata <em>Controllers</em> presente sul progetto Server, possiamo selezionare la voce <em>Aggiungi</em> e successivamente <em>Nuovo elemento…</em>. Selezioniamo poi <strong>API Controller Class – Empty</strong> e digitiamo il nome del nostro controller, <code class="highlighter-rouge">AccountsController.cs</code>:</p>

<p><img src="/assets/articoli/blazor-wasm-jwt-aspnetidentity-p2/image011.png" alt="Struttura progetto aggiornata" /></p>

<p>Nel nuovo controller andiamo ad iniettare tramite dependency injection <code class="highlighter-rouge">ILogger</code> e <code class="highlighter-rouge">IEmailSender</code>, insieme a <code class="highlighter-rouge">UserManager</code>, il servizio che ci fornisce ASP.NET Identity per la gestione degli account. Creeremo l’action <code class="highlighter-rouge">Register</code> che prende in input il modello <code class="highlighter-rouge">RegisterRequest</code> e restituisce l’oggetto <code class="highlighter-rouge">RegisterResponse</code>, che contiene tutto il necessario per capire se la richiesta è andata a buon fine:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="p">[</span><span class="nf">HttpPost</span><span class="p">(</span><span class="s">"[action]"</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">Register</span><span class="p">([</span><span class="n">FromBody</span><span class="p">]</span><span class="n">RegisterRequest</span> <span class="n">registerRequest</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ModelState</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Athlete</span>
            <span class="p">{</span>
                <span class="n">UserName</span> <span class="p">=</span> <span class="n">registerRequest</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span>
                <span class="n">Email</span> <span class="p">=</span> <span class="n">registerRequest</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span>
                <span class="n">LastName</span> <span class="p">=</span> <span class="n">registerRequest</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span>
                <span class="n">FirstName</span> <span class="p">=</span> <span class="n">registerRequest</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span>
                <span class="n">Birthday</span> <span class="p">=</span> <span class="n">registerRequest</span><span class="p">.</span><span class="n">Birthday</span><span class="p">.</span><span class="n">Value</span><span class="p">,</span>
                <span class="n">Sex</span> <span class="p">=</span> <span class="n">registerRequest</span><span class="p">.</span><span class="n">Sex</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="p">?</span> <span class="sc">'M'</span> <span class="p">:</span> <span class="sc">'W'</span>
            <span class="p">};</span>

            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="nf">CreateAsync</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">registerRequest</span><span class="p">.</span><span class="n">Password</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">result</span><span class="p">.</span><span class="n">Succeeded</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">RegisterResponse</span> <span class="n">registerResponse</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RegisterResponse</span>
                <span class="p">{</span>
                    <span class="n">IsSuccess</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                    <span class="n">EmailExist</span> <span class="p">=</span> <span class="n">result</span><span class="p">.</span><span class="n">Errors</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Code</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"DuplicateUserName"</span><span class="p">))</span> <span class="p">!=</span> <span class="k">null</span><span class="p">,</span>
                    <span class="n">Errors</span> <span class="p">=</span> <span class="n">result</span><span class="p">.</span><span class="n">Errors</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Description</span><span class="p">),</span>
                <span class="p">};</span>
                <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">registerResponse</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"User created a new account with password."</span><span class="p">);</span>

            
            <span class="kt">var</span> <span class="n">code</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="nf">GenerateEmailConfirmationTokenAsync</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">urlConfirmation</span> <span class="p">=</span> <span class="s">$"</span><span class="p">{</span><span class="n">Request</span><span class="p">.</span><span class="n">Scheme</span><span class="p">}</span><span class="s">://</span><span class="p">{</span><span class="n">Request</span><span class="p">.</span><span class="n">Host</span><span class="p">}</span><span class="s">/account/emailconfirmation/?userid=</span><span class="p">{</span><span class="n">HttpUtility</span><span class="p">.</span><span class="nf">UrlEncode</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">Id</span><span class="p">)}</span><span class="s">&amp;code=</span><span class="p">{</span><span class="n">HttpUtility</span><span class="p">.</span><span class="nf">UrlEncode</span><span class="p">(</span><span class="n">code</span><span class="p">)}</span><span class="s">"</span><span class="p">;</span> 
            <span class="k">await</span> <span class="n">_emailSender</span><span class="p">.</span><span class="nf">SendMail</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span> <span class="s">"Email confirmation"</span><span class="p">,</span> <span class="s">$"Please confirm your account by &lt;a href='</span><span class="p">{</span><span class="n">urlConfirmation</span><span class="p">}</span><span class="s">'&gt;clicking here&lt;/a&gt;"</span><span class="p">);</span>
            
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="k">new</span> <span class="n">RegisterResponse</span> <span class="p">{</span> <span class="n">IsSuccess</span> <span class="p">=</span> <span class="k">true</span> <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="k">new</span> <span class="n">RegisterResponse</span> <span class="p">{</span> <span class="n">IsSuccess</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="n">Errors</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span> <span class="s">"modello non valido"</span> <span class="p">}</span> <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"User register error: </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="k">new</span> <span class="n">RegisterResponse</span> <span class="p">{</span> <span class="n">IsSuccess</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="n">Errors</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span> <span class="p">}</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Cosa avviene se inseriamo dei dati non corretti? Come abbiamo visto nel precedente articolo, il modello è validato in base alle <em>Data Annotation</em> specificate nella classe <code class="highlighter-rouge">RegisterRequest</code>. Inoltre adesso se a ASP.NET Identity non piacciono i dati che abbiamo inserito, valorizzerà una lista di errori che verranno visualizzati nella form di registrazione per fornire un output chiaro all’utente:</p>

<p><img src="/assets/articoli/blazor-wasm-jwt-aspnetidentity-p2/image012.png" alt="Validazione utente durante la registrazione" /></p>

<p>Cosa accade invece se i dati sono corretti e la creazione dell’utente va a buon fine? Sul database ci sarà la entry contenente il nuovo utente ma latp frontend dobbiamo ancora gestire il risultato.</p>

<p><img src="/assets/articoli/blazor-wasm-jwt-aspnetidentity-p2/image013.png" alt="Utente creato sul database" /></p>

<p>E’ importante notare che il campo <code class="highlighter-rouge">EmailConfirmed</code> sul database è “0”, questo perché una volta creato l’utente è necessario (impostazione di default di ASP.NET Identity) confermare l’indirizzo email. Se non ci sono stati intoppi e se il servizio email è operativo, controllate la casella e-mail perché dovreste aver ricevuto un messagio con il testo: “Please confirm your account by clicking here”. Cliccando però non succede nulla perché non abbiamo ancora gestito la richiesta nel front-end.</p>

<h2 id="conferma-e-mail">Conferma e-mail</h2>
<p>Andiamo a creare sul progetto <em>client</em> la pagina di conferma dell’indirizzo e-mail, che chiamerò con una fantasia spropositata <code class="highlighter-rouge">EmailConfirmation.razor</code>. Ecco il suo contenuto:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">@page "/account/emailconfirmation"
@layout AuthLayout
@inject HttpClient Http
@inject NavigationManager navManager
@using CompTrain.Shared.Models.Account;

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-12"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-warning"</span> <span class="na">role=</span><span class="s">"alert"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"alert-heading"</span><span class="nt">&gt;</span>Ops..<span class="nt">&lt;/h4&gt;</span>
                <span class="nt">&lt;p&gt;</span>Qualcosa <span class="ni">&amp;egrave;</span> andato storto, controlla l'indirizzo che ti è stato inviato per email.<span class="nt">&lt;/p&gt;</span>
                <span class="nt">&lt;hr&gt;</span>
                <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"mb-0"</span><span class="nt">&gt;</span>L'indirizzo email non è confermato e quindi non potrai effettuare la login.<span class="nt">&lt;/p&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">@code</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="k">override</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">OnAfterRenderAsync</span><span class="p">(</span><span class="kt">bool</span> <span class="n">firstRender</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">EmailConfirmationRequest</span> <span class="n">emailConfirmationRequest</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EmailConfirmationRequest</span><span class="p">();</span>

        <span class="kt">var</span> <span class="n">uri</span> <span class="p">=</span> <span class="n">navManager</span><span class="p">.</span><span class="nf">ToAbsoluteUri</span><span class="p">(</span><span class="n">navManager</span><span class="p">.</span><span class="n">Uri</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">QueryHelpers</span><span class="p">.</span><span class="nf">ParseQuery</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="n">Query</span><span class="p">).</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="s">"userid"</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">userid</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">QueryHelpers</span><span class="p">.</span><span class="nf">ParseQuery</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="n">Query</span><span class="p">).</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="s">"code"</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">code</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">emailConfirmationRequest</span><span class="p">.</span><span class="n">UserId</span> <span class="p">=</span> <span class="n">userid</span><span class="p">.</span><span class="nf">First</span><span class="p">();</span>
            <span class="n">emailConfirmationRequest</span><span class="p">.</span><span class="n">Code</span> <span class="p">=</span> <span class="n">code</span><span class="p">.</span><span class="nf">First</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(!</span><span class="n">String</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">emailConfirmationRequest</span><span class="p">.</span><span class="n">UserId</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">String</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">emailConfirmationRequest</span><span class="p">.</span><span class="n">Code</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">IsValid</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Http</span><span class="p">.</span><span class="n">PostJsonAsync</span><span class="p">&lt;</span><span class="kt">bool</span><span class="p">&gt;(</span><span class="s">"api/accounts/emailconfirmation"</span><span class="p">,</span> <span class="n">emailConfirmationRequest</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">IsValid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">navManager</span><span class="p">.</span><span class="nf">NavigateTo</span><span class="p">(</span><span class="s">"/account/login"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Questa pagina ha bisogno di un pacchetto NuGet denominato <code class="highlighter-rouge">Microsoft.AspNetCore.WebUtilities</code>, che utilizziamo per parsare la query string. Ho utilizzato anche la classe <code class="highlighter-rouge">EmailConfirmationRequest</code>, creata nel progetto <code class="highlighter-rouge">Shared</code>, che conterrà i due valori che arrivano dalla URL:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">EmailConfirmationRequest</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">UserId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Code</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Nel controller <code class="highlighter-rouge">AccountController</code> dobbiamo aggiungere il metodo che verifica la validità dell’utente:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="p">[</span><span class="nf">HttpPost</span><span class="p">(</span><span class="s">"[action]"</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">EmailConfirmation</span><span class="p">([</span><span class="n">FromBody</span><span class="p">]</span><span class="n">EmailConfirmationRequest</span> <span class="n">confirmationRequest</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="nf">FindByIdAsync</span><span class="p">(</span><span class="n">confirmationRequest</span><span class="p">.</span><span class="n">UserId</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">user</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"User not found"</span><span class="p">);</span>

        <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="nf">ConfirmEmailAsync</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">confirmationRequest</span><span class="p">.</span><span class="n">Code</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Succeeded</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Email confirmation error: </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s"> - UserID: </span><span class="p">{</span><span class="n">confirmationRequest</span><span class="p">.</span><span class="n">UserId</span><span class="p">}</span><span class="s"> - Code: </span><span class="p">{</span><span class="n">confirmationRequest</span><span class="p">.</span><span class="n">Code</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Non ho creato una classe <em>Response</em> perché il tipo di dato è semplicemente un boolean che indica se tutto è filato liscio. Come avrete potuto notare, la pagina <code class="highlighter-rouge">EmailConfirmation</code> visualizza il messaggio di avviso e solo se la conferma della e-mail va a buon fine, c’è il redirect alla schermata di login (che dobbiamo ancora realizzare).</p>

<p><img src="/assets/articoli/blazor-wasm-jwt-aspnetidentity-p2/image014.png" alt="Avviso e-mail utente non confermata" /></p>

<p>Se controlliamo il database vedremo che l’indirizzo e-mail è stato confermato:</p>

<p><img src="/assets/articoli/blazor-wasm-jwt-aspnetidentity-p2/image015.png" alt="E-mail utente confermata sul database" /></p>

<h2 id="componente-di-notifica-invio-email">Componente di notifica invio email</h2>

<p>Nell’articolo precedente abbiamo lasciato la pagina <code class="highlighter-rouge">Register.razor</code> priva di qualunque feedback per l’utente quando la registrazione va a buon fine:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">RegisterUser</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">registerResponse</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Http</span><span class="p">.</span><span class="n">PostJsonAsync</span><span class="p">&lt;</span><span class="n">RegisterResponse</span><span class="p">&gt;(</span><span class="s">"api/accounts/register"</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">registerResponse</span><span class="p">.</span><span class="n">IsSuccess</span><span class="p">)</span>
    <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Per sopperire a questa mancanza, ho creato il componente <code class="highlighter-rouge">EmailSent.razor</code> (nella cartella <em>Shared</em> del progetto <em>Client</em>) che non fa altro che mostrare un avviso per invitare l’utente a controllare la propria posta. Ecco il contenuto:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-success"</span> <span class="na">role=</span><span class="s">"alert"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"alert-heading"</span><span class="nt">&gt;</span>Perfetto!<span class="nt">&lt;/h4&gt;</span>
    <span class="nt">&lt;p&gt;</span>Controlla nella tua posta elettronica perché ti abbiamo appena inviato una email.<span class="nt">&lt;/p&gt;</span>
    @if (!String.IsNullOrEmpty(Email))
    {
        <span class="nt">&lt;hr&gt;</span>
        <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"mb-0"</span><span class="nt">&gt;</span>Il tuo indirizzo ci risulta essere <span class="nt">&lt;strong&gt;</span>@Email<span class="nt">&lt;/strong&gt;&lt;/p&gt;</span>
    }
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">@code</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">Parameter</span><span class="p">]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Email</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Ed il risultato è questo:</p>

<p><img src="/assets/articoli/blazor-wasm-jwt-aspnetidentity-p2/image016.png" alt="Messaggio di conferma e invito a verificare la posta" /></p>

<p>Riutilizzeremo questo componente anche quando invieremo la mail per il recupero password o il cambio email. Il codice di <code class="highlighter-rouge">Register.razor</code> diventa quindi:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">@page "/account/register"
@layout AuthLayout
@inject HttpClient Http
@using CompTrain.Shared.Models.Account;
@inject NavigationManager navManager

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-12"</span><span class="nt">&gt;</span>
        @if ((registerResponse?.IsSuccess).GetValueOrDefault() == false)
        {
            <span class="nt">&lt;h2&gt;</span>Create new account<span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;EditForm</span> <span class="na">Model=</span><span class="s">"model"</span> <span class="na">OnValidSubmit=</span><span class="s">"RegisterUser"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;RadzenCard&gt;</span>
                    <span class="nt">&lt;label&gt;</span>First Name<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;RadzenTextBox</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"model.FirstName"</span><span class="nt">&gt;&lt;/RadzenTextBox&gt;</span>

                    <span class="nt">&lt;label&gt;</span>Last Name<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;RadzenTextBox</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"model.LastName"</span><span class="nt">&gt;&lt;/RadzenTextBox&gt;</span>

                    <span class="nt">&lt;label&gt;</span>Birthday<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;RadzenDatePicker</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"model.Birthday"</span> <span class="na">DateFormat=</span><span class="s">"dd/MM/yyyy"</span> <span class="nt">/&gt;</span>

                    <span class="nt">&lt;label&gt;</span>Sex<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;RadzenRadioButtonList</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"model.Sex"</span> <span class="na">TValue=</span><span class="s">"int?"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;Items&gt;</span>
                            <span class="nt">&lt;RadzenRadioButtonListItem</span> <span class="na">Text=</span><span class="s">"Man"</span> <span class="na">Value=</span><span class="s">"1"</span> <span class="na">TValue=</span><span class="s">"int?"</span> <span class="nt">/&gt;</span>
                            <span class="nt">&lt;RadzenRadioButtonListItem</span> <span class="na">Text=</span><span class="s">"Woman"</span> <span class="na">Value=</span><span class="s">"2"</span> <span class="na">TValue=</span><span class="s">"int?"</span> <span class="nt">/&gt;</span>
                        <span class="nt">&lt;/Items&gt;</span>
                    <span class="nt">&lt;/RadzenRadioButtonList&gt;</span>


                    <span class="nt">&lt;label&gt;</span>Email<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;RadzenTextBox</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"model.Email"</span><span class="nt">&gt;&lt;/RadzenTextBox&gt;</span>

                    <span class="nt">&lt;label&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;RadzenPassword</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"model.Password"</span><span class="nt">&gt;&lt;/RadzenPassword&gt;</span>

                    <span class="nt">&lt;label&gt;</span>Confirm Password<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;RadzenPassword</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"model.ConfirmPassword"</span><span class="nt">&gt;&lt;/RadzenPassword&gt;</span>

                    <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;DataAnnotationsValidator</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;ValidationSummary</span> <span class="nt">/&gt;</span>


                    <span class="nt">&lt;Alert</span> <span class="na">Title=</span><span class="s">"Attenzione"</span> <span class="na">ErrorList=</span><span class="s">"registerResponse?.Errors"</span> <span class="nt">/&gt;</span>
                    @if ((registerResponse?.EmailExist).GetValueOrDefault())
                    {
                        <span class="nt">&lt;RadzenButton</span> <span class="na">ButtonType=</span><span class="s">"Radzen.ButtonType.Button"</span> <span class="na">Click=</span><span class="s">"@((args) =&gt; GoToPage(args, "</span><span class="na">forgotpassword</span><span class="err">"))"</span> <span class="na">Text=</span><span class="s">"Reset password?"</span> <span class="na">Icon=</span><span class="s">"lock_open"</span> <span class="na">ButtonStyle=</span><span class="s">"Radzen.ButtonStyle.Secondary"</span> <span class="na">class=</span><span class="s">"btn-block btn-sm mr-2"</span><span class="nt">&gt;&lt;/RadzenButton&gt;</span>
                        <span class="nt">&lt;RadzenButton</span> <span class="na">ButtonType=</span><span class="s">"Radzen.ButtonType.Button"</span><span class="na">Click=</span><span class="s">"@((args) =&gt; GoToPage(args, "</span><span class="na">login</span><span class="err">"))"</span> <span class="na">Text=</span><span class="s">"Login"</span> <span class="na">Icon=</span><span class="s">"account_circle"</span> <span class="na">ButtonStyle=</span><span class="s">"Radzen.ButtonStyle.Info"</span> <span class="na">class=</span><span class="s">"btn-block btn-sm mr-2"</span><span class="nt">&gt;&lt;/RadzenButton&gt;</span>
                        <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
                    }

                    <span class="nt">&lt;RadzenButton</span> <span class="na">ButtonType=</span><span class="s">"Radzen.ButtonType.Submit"</span> <span class="na">Text=</span><span class="s">"Register"</span> <span class="na">Icon=</span><span class="s">"verified_user"</span> <span class="na">ButtonStyle=</span><span class="s">"Radzen.ButtonStyle.Primary"</span> <span class="na">class=</span><span class="s">"btn-block mr-2"</span><span class="nt">&gt;&lt;/RadzenButton&gt;</span>

                <span class="nt">&lt;/RadzenCard&gt;</span>
            <span class="nt">&lt;/EditForm&gt;</span>
        }
        else
        {
            <span class="nt">&lt;EmailSent</span> <span class="na">Email=</span><span class="s">"@model.Email"</span> <span class="nt">/&gt;</span>
        }
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">@code</span> <span class="p">{</span>
    <span class="n">RegisterRequest</span> <span class="n">model</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RegisterRequest</span><span class="p">();</span>
    <span class="n">RegisterResponse</span> <span class="n">registerResponse</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">RegisterUser</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">registerResponse</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Http</span><span class="p">.</span><span class="n">PostJsonAsync</span><span class="p">&lt;</span><span class="n">RegisterResponse</span><span class="p">&gt;(</span><span class="s">"api/accounts/register"</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">void</span> <span class="nf">GoToPage</span><span class="p">(</span><span class="n">MouseEventArgs</span> <span class="n">args</span><span class="p">,</span> <span class="kt">string</span> <span class="n">page</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">navManager</span><span class="p">.</span><span class="nf">NavigateTo</span><span class="p">(</span><span class="s">$"/account/</span><span class="p">{</span><span class="n">page</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h2 id="recupero-password">Recupero password</h2>

<p>E’ indispensabile per qualsiasi sistema di autenticazione fornire la funzionalità di recupero password. Andiamo quindi ad implementare la pagina che si occuperà di gestire la richiesta di reset password. La nuova pagina l’ho chiamata <code class="highlighter-rouge">ForgotPassword.razor</code> ed il suo contenuto è il seguente:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">@page "/account/forgotpassword"
@layout AuthLayout
@inject HttpClient Http
@using CompTrain.Shared.Models.Account;
@inject NavigationManager navManager

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-12"</span><span class="nt">&gt;</span>
        @if ((forgotPasswordResponse?.IsSuccess).GetValueOrDefault() == false)
        {
            <span class="nt">&lt;h2&gt;</span>Forgot password<span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;EditForm</span> <span class="na">Model=</span><span class="s">"model"</span> <span class="na">OnValidSubmit=</span><span class="s">"ResetPassword"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;RadzenCard&gt;</span>
                    <span class="nt">&lt;label&gt;</span>Email<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;RadzenTextBox</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"model.Email"</span><span class="nt">&gt;&lt;/RadzenTextBox&gt;</span>
                    <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;DataAnnotationsValidator</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;ValidationSummary</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;Alert</span> <span class="na">Title=</span><span class="s">"Attenzione"</span> <span class="na">ErrorList=</span><span class="s">"forgotPasswordResponse?.Errors"</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;RadzenButton</span> <span class="na">ButtonType=</span><span class="s">"Radzen.ButtonType.Submit"</span> <span class="na">Text=</span><span class="s">"Reset Password"</span> <span class="na">Icon=</span><span class="s">"track_changes"</span> <span class="na">ButtonStyle=</span><span class="s">"Radzen.ButtonStyle.Primary"</span> <span class="na">class=</span><span class="s">"btn-block mr-2"</span><span class="nt">&gt;&lt;/RadzenButton&gt;</span>
                <span class="nt">&lt;/RadzenCard&gt;</span>
            <span class="nt">&lt;/EditForm&gt;</span>
        }
        else
        {
            <span class="nt">&lt;EmailSent</span> <span class="na">Email=</span><span class="s">"@model.Email"</span> <span class="nt">/&gt;</span>
        }
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">@code</span> <span class="p">{</span>
    <span class="n">ForgotPasswordRequest</span> <span class="n">model</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ForgotPasswordRequest</span><span class="p">();</span>
    <span class="n">ForgotPasswordResponse</span> <span class="n">forgotPasswordResponse</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">ResetPassword</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">forgotPasswordResponse</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Http</span><span class="p">.</span><span class="n">PostJsonAsync</span><span class="p">&lt;</span><span class="n">ForgotPasswordResponse</span><span class="p">&gt;(</span><span class="s">"api/accounts/forgotpassword"</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Ecco come si presenta la pagina:</p>

<p><img src="/assets/articoli/blazor-wasm-jwt-aspnetidentity-p2/image017.png" alt="Pagina recupero password" /></p>

<p>Andiamo quindi ad aggiungere le due classi usate per la <em>Request</em> e la <em>Response</em>:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">ForgotPasswordRequest</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
    <span class="p">[</span><span class="nf">StringLength</span><span class="p">(</span><span class="m">50</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Email</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">ForgotPasswordResponse</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsSuccess</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">Errors</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Entrambi i file sono stati creati nel progetto <em>Shared</em>:</p>

<p><img src="/assets/articoli/blazor-wasm-jwt-aspnetidentity-p2/image018.png" alt="Struttura progetto con i nuovi files" /></p>

<p>E’ necessario aggiungere anche il metodo sul controller <code class="highlighter-rouge">Accounts</code>:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="p">[</span><span class="nf">HttpPost</span><span class="p">(</span><span class="s">"[action]"</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">ForgotPassword</span><span class="p">([</span><span class="n">FromBody</span><span class="p">]</span><span class="n">ForgotPasswordRequest</span> <span class="n">forgotPasswordRequest</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ForgotPasswordResponse</span> <span class="n">response</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ForgotPasswordResponse</span><span class="p">();</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="nf">FindByEmailAsync</span><span class="p">(</span><span class="n">forgotPasswordRequest</span><span class="p">.</span><span class="n">Email</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">user</span> <span class="p">==</span> <span class="k">null</span> <span class="p">||</span> <span class="p">!(</span><span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="nf">IsEmailConfirmedAsync</span><span class="p">(</span><span class="n">user</span><span class="p">)))</span>
        <span class="p">{</span>
            <span class="n">response</span><span class="p">.</span><span class="n">Errors</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span> <span class="s">"User not found or not confirmed email"</span> <span class="p">};</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            
            <span class="kt">var</span> <span class="n">code</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_userManager</span><span class="p">.</span><span class="nf">GeneratePasswordResetTokenAsync</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">urlConfirmation</span> <span class="p">=</span> <span class="s">$"</span><span class="p">{</span><span class="n">Request</span><span class="p">.</span><span class="n">Scheme</span><span class="p">}</span><span class="s">://</span><span class="p">{</span><span class="n">Request</span><span class="p">.</span><span class="n">Host</span><span class="p">}</span><span class="s">/account/changepassword/?code=</span><span class="p">{</span><span class="n">HttpUtility</span><span class="p">.</span><span class="nf">UrlEncode</span><span class="p">(</span><span class="n">code</span><span class="p">)}</span><span class="s">"</span><span class="p">;</span>
            <span class="k">await</span> <span class="n">_emailSender</span><span class="p">.</span><span class="nf">SendMail</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span> <span class="s">"Reset password"</span><span class="p">,</span> <span class="s">$"Please reset your password by &lt;a href='</span><span class="p">{</span><span class="n">urlConfirmation</span><span class="p">}</span><span class="s">'&gt;clicking here&lt;/a&gt;"</span><span class="p">);</span>
            <span class="n">response</span><span class="p">.</span><span class="n">IsSuccess</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>

    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Forgot password error: </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s"> - Email: </span><span class="p">{</span><span class="n">forgotPasswordRequest</span><span class="p">.</span><span class="n">Email</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="n">response</span><span class="p">.</span><span class="n">Errors</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span> <span class="p">};</span>
        <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Se adesso proviamo a fare il reset della password dovrebbe arrivarci una e-mail con un link e quindi dobbiamo gestire la pagina che abbiamo predisposto nel link e che ho chiamato <code class="highlighter-rouge">ChangePassword.razor</code> che si trova nel progetto <em>Shared</em>. Il suo contenuto è il seguente:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">@page "/account/changepassword"
@layout AuthLayout
@inject HttpClient Http
@using CompTrain.Shared.Models.Account;
@inject NavigationManager navManager

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-12"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h2&gt;</span>Change password<span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;EditForm</span> <span class="na">Model=</span><span class="s">"model"</span> <span class="na">OnValidSubmit=</span><span class="s">"Change"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;RadzenCard&gt;</span>
                    <span class="nt">&lt;label&gt;</span>Email<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;RadzenTextBox</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"model.Email"</span><span class="nt">&gt;&lt;/RadzenTextBox&gt;</span>

                    <span class="nt">&lt;label&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;RadzenPassword</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"model.Password"</span><span class="nt">&gt;&lt;/RadzenPassword&gt;</span>

                    <span class="nt">&lt;label&gt;</span>Confirm Password<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;RadzenPassword</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"model.ConfirmPassword"</span><span class="nt">&gt;&lt;/RadzenPassword&gt;</span>
                    <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;DataAnnotationsValidator</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;ValidationSummary</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;Alert</span> <span class="na">Title=</span><span class="s">"Attenzione"</span> <span class="na">ErrorList=</span><span class="s">"changePasswordResponse?.Errors"</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;RadzenButton</span> <span class="na">ButtonType=</span><span class="s">"Radzen.ButtonType.Submit"</span> <span class="na">Text=</span><span class="s">"Reset Password"</span> <span class="na">Icon=</span><span class="s">"track_changes"</span> <span class="na">ButtonStyle=</span><span class="s">"Radzen.ButtonStyle.Primary"</span> <span class="na">class=</span><span class="s">"btn-block mr-2"</span><span class="nt">&gt;&lt;/RadzenButton&gt;</span>
                <span class="nt">&lt;/RadzenCard&gt;</span>
            <span class="nt">&lt;/EditForm&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">@code</span> <span class="p">{</span>
    <span class="n">ChangePasswordRequest</span> <span class="n">model</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ChangePasswordRequest</span><span class="p">();</span>
    <span class="n">ChangePasswordResponse</span> <span class="n">changePasswordResponse</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnAfterRender</span><span class="p">(</span><span class="kt">bool</span> <span class="n">firstRender</span><span class="p">)</span>
    <span class="p">{</span>

        <span class="kt">var</span> <span class="n">uri</span> <span class="p">=</span> <span class="n">navManager</span><span class="p">.</span><span class="nf">ToAbsoluteUri</span><span class="p">(</span><span class="n">navManager</span><span class="p">.</span><span class="n">Uri</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">QueryHelpers</span><span class="p">.</span><span class="nf">ParseQuery</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="n">Query</span><span class="p">).</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="s">"code"</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">code</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">model</span><span class="p">.</span><span class="n">Code</span> <span class="p">=</span> <span class="n">code</span><span class="p">.</span><span class="nf">First</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Change</span><span class="p">()</span>
    <span class="p">{</span>

        <span class="n">changePasswordResponse</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Http</span><span class="p">.</span><span class="n">PostJsonAsync</span><span class="p">&lt;</span><span class="n">ChangePasswordResponse</span><span class="p">&gt;(</span><span class="s">"api/accounts/changepassword"</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">changePasswordResponse</span><span class="p">.</span><span class="n">IsSuccess</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">navManager</span><span class="p">.</span><span class="nf">NavigateTo</span><span class="p">(</span><span class="s">"/account/login"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>La pagina visualizzata sarà la seguente:</p>

<p><img src="/assets/articoli/blazor-wasm-jwt-aspnetidentity-p2/image019.png" alt="Pagina cambio password" /></p>

<p>Se URL ed dati inseriti sono corretti si verrà reindirizzati alla login.</p>

<h2 id="login">Login</h2>

<p>Abbiamo tutto il necessario per creare la pagina di login quindi creiamo il nuovo file razor chiamato appunto <code class="highlighter-rouge">Login.razor</code>, che conterrà il seguente codice:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">@page "/account/login"
@layout AuthLayout
@inject HttpClient Http
@using CompTrain.Shared.Models.Account;
@inject NavigationManager navManager

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-12"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h2&gt;</span>Login<span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;EditForm</span> <span class="na">Model=</span><span class="s">"model"</span> <span class="na">OnValidSubmit=</span><span class="s">"UserLogin"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;RadzenCard&gt;</span>
                <span class="nt">&lt;label&gt;</span>Email<span class="nt">&lt;/label&gt;</span>
                <span class="nt">&lt;RadzenTextBox</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"model.Email"</span><span class="nt">&gt;&lt;/RadzenTextBox&gt;</span>

                <span class="nt">&lt;label&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
                <span class="nt">&lt;RadzenPassword</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"model.Password"</span><span class="nt">&gt;&lt;/RadzenPassword&gt;</span>

                <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;DataAnnotationsValidator</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;ValidationSummary</span> <span class="nt">/&gt;</span>


                <span class="nt">&lt;Alert</span> <span class="na">Title=</span><span class="s">"Attenzione"</span> <span class="na">ErrorList=</span><span class="s">"loginResponse?.Errors"</span> <span class="nt">/&gt;</span>

                <span class="nt">&lt;RadzenButton</span> <span class="na">ButtonType=</span><span class="s">"Radzen.ButtonType.Submit"</span> <span class="na">Text=</span><span class="s">"Login"</span> <span class="na">Icon=</span><span class="s">"account_circle"</span> <span class="na">ButtonStyle=</span><span class="s">"Radzen.ButtonStyle.Info"</span> <span class="na">class=</span><span class="s">"btn-block mr-2"</span><span class="nt">&gt;&lt;/RadzenButton&gt;</span>
                <span class="nt">&lt;hr</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;RadzenButton</span> <span class="na">ButtonType=</span><span class="s">"Radzen.ButtonType.Button"</span> <span class="na">Click=</span><span class="s">"@((args) =&gt; GoToPage(args, "</span><span class="na">forgotpassword</span><span class="err">"))"</span> <span class="na">Text=</span><span class="s">"Reset password?"</span> <span class="na">Icon=</span><span class="s">"lock_open"</span> <span class="na">ButtonStyle=</span><span class="s">"Radzen.ButtonStyle.Secondary"</span> <span class="na">class=</span><span class="s">"btn-block btn-sm mr-2"</span><span class="nt">&gt;&lt;/RadzenButton&gt;</span>
                <span class="nt">&lt;RadzenButton</span> <span class="na">ButtonType=</span><span class="s">"Radzen.ButtonType.Button"</span> <span class="na">Click=</span><span class="s">"@((args) =&gt; GoToPage(args, "</span><span class="na">register</span><span class="err">"))"</span> <span class="na">Text=</span><span class="s">"Register"</span> <span class="na">Icon=</span><span class="s">"verified_user"</span> <span class="na">ButtonStyle=</span><span class="s">"Radzen.ButtonStyle.Primary"</span> <span class="na">class=</span><span class="s">"btn-block btn-sm mr-2"</span><span class="nt">&gt;&lt;/RadzenButton&gt;</span>
            <span class="nt">&lt;/RadzenCard&gt;</span>
        <span class="nt">&lt;/EditForm&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">@code</span> <span class="p">{</span>
    <span class="n">LoginRequest</span> <span class="n">model</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">LoginRequest</span><span class="p">();</span>
    <span class="n">LoginResponse</span> <span class="n">loginResponse</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">UserLogin</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">loginResponse</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Http</span><span class="p">.</span><span class="n">PostJsonAsync</span><span class="p">&lt;</span><span class="n">LoginResponse</span><span class="p">&gt;(</span><span class="s">"api/accounts/login"</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">loginResponse</span><span class="p">.</span><span class="n">IsSuccess</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">navManager</span><span class="p">.</span><span class="nf">NavigateTo</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">void</span> <span class="nf">GoToPage</span><span class="p">(</span><span class="n">MouseEventArgs</span> <span class="n">args</span><span class="p">,</span> <span class="kt">string</span> <span class="n">page</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">navManager</span><span class="p">.</span><span class="nf">NavigateTo</span><span class="p">(</span><span class="s">$"/account/</span><span class="p">{</span><span class="n">page</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>L’aspetto grafico è questo:</p>

<p><img src="/assets/articoli/blazor-wasm-jwt-aspnetidentity-p2/image020.png" alt="Pagina login" /></p>

<p>Anche qui sono necessarie le due classi di <em>Request</em> e <em>Response</em>:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">LoginRequest</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
    <span class="p">[</span><span class="nf">StringLength</span><span class="p">(</span><span class="m">50</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Email</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
    <span class="p">[</span><span class="nf">StringLength</span><span class="p">(</span><span class="m">16</span><span class="p">,</span> <span class="n">ErrorMessage</span> <span class="p">=</span> <span class="s">"{0} length must be between {2} and {1}."</span><span class="p">,</span> <span class="n">MinimumLength</span> <span class="p">=</span> <span class="m">8</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Password</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">LoginResponse</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsSuccess</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">Errors</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Token</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Nel prossimo articolo vedremo come effettuare il login e quindi gestire l’autenticazione.</p>

  </div><a class="u-url" href="/blazor/security/2020/04/14/blazor-wasm-jwt-aspnetidentity-p2.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <h2 class="footer-heading">Blazor Developer Italiani</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Blazor Developer Italiani</li>
          <li>
            <a class="u-email" href="mailto:blazordevita@hotmail.com"
              >blazordevita@hotmail.com</a
            >
          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          <li>
            <a href="https://github.com/blazordevita"
              ><svg class="svg-icon">
                <use xlink:href="/assets/minima-social-icons.svg#github"></use>
              </svg>
              <span class="username">blazordevita</span></a
            >
          </li>
          <li>
            <a href="https://www.twitter.com/blazordevita"
              ><svg class="svg-icon">
                <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
              </svg>
              <span class="username">blazordevita</span></a
            >
          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <div id="mc_embed_signup">
            <form action="https://blazordev.us4.list-manage.com/subscribe/post?u=8f245a8c9245ef047e4b82346&amp;id=d5087d65ba" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                <div id="mc_embed_signup_scroll">
                <label for="mce-EMAIL">Newsletter:</label>&nbsp;
                <input type="email" style="width:150px" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="indirizzo email" required>
                <input type="submit" value="Iscriviti" name="subscribe" id="mc-embedded-subscribe" class="button">
                <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_8f245a8c9245ef047e4b82346_d5087d65ba" tabindex="-1" value=""></div>
                <div class="clear"></div>
                </div>
            </form>
        </div>
        <br />
        <p>
            La prima community italiana dedicata allo sviluppo di applicazioni con
            Blazor, il framework Microsoft per la realizzazione di Single Page
            Application con .NET Core, SignalR, WebAssembly e Razor
          </p>
      </div>
    </div>
  </div>
</footer>
</body>

</html>
