<!DOCTYPE html>
<html lang="it"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/icon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/icon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/icon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/icon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/icon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/icon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/icon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/icon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/icon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/icon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/icon/favicon-16x16.png">
    <link rel="manifest" href="/assets/icon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Creare una SPA: gestione Form | Blazor Developer Italiani</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Creare una SPA: gestione Form" />
<meta name="author" content="Michele Aponte" />
<meta property="og:locale" content="it" />
<meta name="description" content="In un’applicazione enterprise l’inserimento dati da parte dell’utente è una attività fondamentale, per la quale ogni framework di front-end mette a disposizione librerie apposite che permettono sia la cattura dell’input che la sua validazione formale, attività spesso noiosa e ripetitiva. Blazor ci fornisce tutta una serie di componenti già pronti a questo scopo, nonchè la possibilità di sfruttare le tecniche di validazione del .NET Framework che già conosciamo." />
<meta property="og:description" content="In un’applicazione enterprise l’inserimento dati da parte dell’utente è una attività fondamentale, per la quale ogni framework di front-end mette a disposizione librerie apposite che permettono sia la cattura dell’input che la sua validazione formale, attività spesso noiosa e ripetitiva. Blazor ci fornisce tutta una serie di componenti già pronti a questo scopo, nonchè la possibilità di sfruttare le tecniche di validazione del .NET Framework che già conosciamo." />
<link rel="canonical" href="/blazor/spa/2020/03/03/spa-gestione-form.html" />
<meta property="og:url" content="/blazor/spa/2020/03/03/spa-gestione-form.html" />
<meta property="og:site_name" content="Blazor Developer Italiani" />
<meta property="og:image" content="/assets/articoli/spa-gestione-form/spa-gestione-form.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-03-03T00:00:00+01:00" />
<script type="application/ld+json">
{"datePublished":"2020-03-03T00:00:00+01:00","headline":"Creare una SPA: gestione Form","dateModified":"2020-03-03T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"/blazor/spa/2020/03/03/spa-gestione-form.html"},"image":"/assets/articoli/spa-gestione-form/spa-gestione-form.png","author":{"@type":"Person","name":"Michele Aponte"},"description":"In un’applicazione enterprise l’inserimento dati da parte dell’utente è una attività fondamentale, per la quale ogni framework di front-end mette a disposizione librerie apposite che permettono sia la cattura dell’input che la sua validazione formale, attività spesso noiosa e ripetitiva. Blazor ci fornisce tutta una serie di componenti già pronti a questo scopo, nonchè la possibilità di sfruttare le tecniche di validazione del .NET Framework che già conosciamo.","url":"/blazor/spa/2020/03/03/spa-gestione-form.html","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/site.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Blazor Developer Italiani" /><script async src="https://www.googletagmanager.com/gtag/js?id="></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55415192-2"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-55415192-2');
    </script>
</head><body><header class="site-header">

    <div class="wrapper"><img class="logo" src="/assets/img/blazordevita_logo.png" alt="logo blazor developer italiani" />
      <a class="site-title" rel="author" href="/">Blazor Developer Italiani</a><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
              </svg>
            </span>
          </label>
  
          <div class="trigger"><a class="page-link" href="/chisiamo/">Chi Siamo</a><a class="page-link" href="/articoli/">Articoli</a><a class="page-link" href="/eventi/">Eventi</a><a class="page-link" href="/sponsor/">Sponsor</a></div>
        </nav></div>
  </header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h3 class="post-subtitle">Inserimento dati con le form di Blazor</h3>
    <h1 class="post-title p-name" itemprop="name headline">Creare una SPA: gestione Form</h1>
    <h4>Data pubblicazione: 03-03-2020 - Autore: Michele Aponte</h4>
  </header><figure>
      <img src="/assets/articoli/spa-gestione-form/spa-gestione-form.png" alt="Creare una SPA: gestione Form" />
  </figure><div class="post-content e-content" itemprop="articleBody">
    <p>In un’applicazione enterprise l’inserimento dati da parte dell’utente è una attività fondamentale, per la quale ogni framework di front-end mette a disposizione librerie apposite che permettono sia la cattura dell’input che la sua validazione formale, attività spesso noiosa e ripetitiva. Blazor ci fornisce tutta una serie di componenti già pronti a questo scopo, nonchè la possibilità di sfruttare le tecniche di validazione del .NET Framework che già conosciamo.</p>

<h2 id="i-componenti-form">I componenti Form</h2>

<p>La cattura dell’input è un’attività facilmente isolabile in un componente e Blazor ha già fatto questo lavoro per noi per tutti i casi semplici. Questa tipologia di componenti sfrutta la possibilità di specificare un modello come tipo di dati su cui lavorare, facilitandoci non poco il compito della realizzazione di una form e supportandoci con la forte tipizzazione di cui gode .NET.</p>

<p>Partiamo dunque dalla definizione del dettaglio di un Evento, nel quale andiamo a inserire tutte le proprietà che vogliamo utilizzare nella form di dettaglio. Nella cartella Models andiamo ad aggiungere una classe <code class="highlighter-rouge">Evento</code> con la seguente definizione:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Evento</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Nome</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Localita</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">Data</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Descrizione</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Note</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Nella cartella Components andiamo a creare un componente per la gestione del dettaglio evento, creando il file <code class="highlighter-rouge">DettaglioEvento.razor</code>. La definizione di una form parte da un elemento contenitore denominato <code class="highlighter-rouge">&lt;EditForm&gt;&lt;/EditForm&gt;</code>, sul quale possiamo specificare il nome di una proprietà che rappresenta il nostro modello dati e la callback da invocare quando l’utente richiederà la sottomissione della form:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;h2&gt;</span>Evento @DettaglioElemento.Nome<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;EditForm</span> 
    <span class="na">Model=</span><span class="s">"@DettaglioElemento"</span>
    <span class="na">OnValidSubmit=</span><span class="s">"@(e =&gt; OnSalva.InvokeAsync(DettaglioElemento))"</span><span class="nt">&gt;</span>
    
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Salva<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-warning"</span> <span class="na">onclick=</span><span class="s">"OnAnnulla"</span><span class="nt">&gt;</span>Annulla<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/EditForm&gt;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">@code</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">Parameter</span><span class="p">]</span>
    <span class="k">public</span> <span class="n">Evento</span> <span class="n">DettaglioElemento</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="n">Parameter</span><span class="p">]</span>
    <span class="k">public</span> <span class="n">EventCallback</span><span class="p">&lt;</span><span class="n">Evento</span><span class="p">&gt;</span> <span class="n">OnSalva</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="n">Parameter</span><span class="p">]</span>
    <span class="k">public</span> <span class="n">EventCallback</span> <span class="n">OnAnnulla</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Il componente utilizza il tipo del modello specificato (nel nostro caso la classe Evento) per tipizzare la nostra form. Aggiungiamo due pulsanti, uno per il salvataggio e l’altro per annullare l’operazione. Per il salvataggio definiamo il solo markup del pulsante, dato che, utilizzando un pulsante di tipo <code class="highlighter-rouge">submit</code>, l’operazione richiesta sarà direttamente collegata alla sottomissione della form. Per il pulsante di annullamente invece andiamo a catturare l’evento click, collegandolo a un paramentro <code class="highlighter-rouge">EventCallback</code> che chiamiamo <code class="highlighter-rouge">OnAnnulla</code>, in modo che chi utilizza il nostro componente possa reagire all’evento. Per completezza aggiungiamo in cima al componente un titolo, riportando il nome dell’evento su cui stiamo lavorando.</p>

<p>Non ci resta che aggiungere i vari campi, utilizzando un componente specifico per ogni tipologia di Input che vogliamo visualizzare. Se vogliamo ad esempio visualizzare una classica casella di testo, possiamo utilizzare il componente <code class="highlighter-rouge">InputText</code>, che renderizzerà per noi un elemento <code class="highlighter-rouge">&lt;input type="text" /&gt;</code>. Allo stesso modo abbiamo un componente per la textarea (<code class="highlighter-rouge">InputTextArea</code>), per la select (<code class="highlighter-rouge">InputSelect</code>), la input di tipo numerica (<code class="highlighter-rouge">InputNumber</code>), checkbox (<code class="highlighter-rouge">InputCheckBox</code>) e date (<code class="highlighter-rouge">InputDate</code>). Su questi elementi possiamo applicare le classi CSS che preferiamo, quindi anche le classi di Bootstrap per la gestione delle form:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;EditForm</span> 
    <span class="na">Model=</span><span class="s">"@DettaglioElemento"</span> 
    <span class="na">OnValidSubmit=</span><span class="s">"@(e =&gt; OnSalva.InvokeAsync(DettaglioElemento))"</span><span class="nt">&gt;</span>
    
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"nome"</span><span class="nt">&gt;</span>Nome:<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;InputText</span> <span class="na">id=</span><span class="s">"nome"</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"DettaglioElemento.Nome"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"localita"</span><span class="nt">&gt;</span>Località:<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;InputText</span> <span class="na">id=</span><span class="s">"localita"</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"DettaglioElemento.Localita"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"data"</span><span class="nt">&gt;</span>Data:<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;InputDate</span> <span class="na">id=</span><span class="s">"data"</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"DettaglioElemento.Data"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"descrizione"</span><span class="nt">&gt;</span>Descrizione:<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;InputText</span> <span class="na">id=</span><span class="s">"descrizione"</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"DettaglioElemento.Descrizione"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"note"</span><span class="nt">&gt;</span>Note:<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;InputTextArea</span> <span class="na">id=</span><span class="s">"note"</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"DettaglioElemento.Note"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Salva<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-warning"</span> <span class="err">@</span><span class="na">onclick=</span><span class="s">"OnAnnulla"</span><span class="nt">&gt;</span>Annulla<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/EditForm&gt;</span></code></pre></figure>

<p>Un po’ di classi Bootstrap con i componenti di Blazor e il gioco è fatto! Da notare il <strong><em>binding</em></strong> del valore dell’input con la corrispondente proprietà del modello, utilizzando la direttiva <code class="highlighter-rouge">@bind-Value</code>, che è l’unico caso di <strong><em>binding bidirezionale</em></strong> nel framework, nonchè l’unico caso in cui abbia senso visto che solo nelle form l’utente può modificare i dati.</p>

<p>Andiamo adesso nella pagina Eventi e aggiungiamo questo nuovo componente alla gestione della CRUD. Per dare un po’ di interattività, aggiungiamo una proprietà <code class="highlighter-rouge">EventoCorrente</code> di tipo <code class="highlighter-rouge">Evento</code>, che rappresenta l’evento su cui vogliamo lavorare. Quindi nel caso l’utente richieda la creazione di un nuovo evento, questa proprietà sarà una nuova istanza della classe, mentre nel caso l’utente chieda di modificare un evento esistente possiamo riversare i dati dell’evento selezionato nell’evento corrente.</p>

<p>Aggiungiamo al componente ListaEventi un pulsante di creazione e un pulsante di modifica da poter catturare e gestire:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;h2&gt;</span>Evento @DettaglioElemento.Nome<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-primary mb-4"</span> 
    <span class="err">@</span><span class="na">onclick=</span><span class="s">"OnCrea"</span><span class="nt">&gt;</span>Crea Evento<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tr&gt;</span>...<span class="nt">&lt;/tr&gt;</span>
    @foreach(var evento in ListaElementi)
    {
    <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td&gt;</span>@evento.Id<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>@evento.Nome<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>@evento.Localita<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>@evento.Data<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;th&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-warning"</span> 
                <span class="err">@</span><span class="na">onclick=</span><span class="s">"e =&gt; OnModifica.InvokeAsync(evento)"</span><span class="nt">&gt;</span>Modifica<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-danger"</span> 
                <span class="err">@</span><span class="na">onclick=</span><span class="s">"e =&gt; OnElimina.InvokeAsync(evento)"</span><span class="nt">&gt;</span>Elimina<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
    }
<span class="nt">&lt;/table&gt;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">@code</span> <span class="p">{</span>
    <span class="p">...</span>

    <span class="p">[</span><span class="n">Parameter</span><span class="p">]</span>
    <span class="k">public</span> <span class="n">EventCallback</span> <span class="n">OnCrea</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    
    <span class="p">[</span><span class="n">Parameter</span><span class="p">]</span>
    <span class="k">public</span> <span class="n">EventCallback</span><span class="p">&lt;</span><span class="n">ElementoListaEventi</span><span class="p">&gt;</span> <span class="n">OnModifica</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    
    <span class="p">...</span>
<span class="p">}</span></code></pre></figure>

<p>A questo punto un semplice <code class="highlighter-rouge">if</code> ci permetterà di passare dalla visualizzazione lista a quella dettaglio, dandoci la sensazione di navigare da una all’altra, aiutati dalla cattura degli eventi di entrambi i componenti, utilizzati per valorizzare l’evento corrente:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">@page "/eventi"
@if(EventoCorrente == null)
{
    <span class="nt">&lt;ListaEventi</span> 
        <span class="na">ListaElementi=</span><span class="s">"ListaEventi"</span> <span class="na">OnElimina=</span><span class="s">"EliminaEvento"</span>
        <span class="na">OnCrea=</span><span class="s">"CreaEvento"</span> <span class="na">OnModifica=</span><span class="s">"ModificaEvento"</span> <span class="nt">/&gt;</span>
}
else
{
    <span class="nt">&lt;DettaglioEvento</span> 
        <span class="na">DettaglioElemento=</span><span class="s">"EventoCorrente"</span>
        <span class="na">OnSalva=</span><span class="s">"SalvaEvento"</span> <span class="na">OnAnnulla=</span><span class="s">"AnnullaOperazione"</span> <span class="nt">/&gt;</span>
}</code></pre></figure>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">@code</span> <span class="p">{</span>

    <span class="k">public</span> <span class="n">Evento</span> <span class="n">EventoCorrente</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="n">List</span><span class="p">&lt;</span><span class="n">ElementoListaEventi</span><span class="p">&gt;</span> <span class="n">ListaEventi</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> 
        <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ElementoListaEventi</span><span class="p">&gt;</span>
            <span class="p">{</span>
                <span class="k">new</span> <span class="nf">ElementoListaEventi</span><span class="p">()</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">Nome</span><span class="p">=</span><span class="s">"DevDay Benevento - Blazor"</span><span class="p">,</span> <span class="n">Localita</span><span class="p">=</span><span class="s">"Benvento"</span><span class="p">,</span> <span class="n">Data</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">2020</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span><span class="m">8</span><span class="p">)},</span>
                <span class="k">new</span> <span class="nf">ElementoListaEventi</span><span class="p">()</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">Nome</span><span class="p">=</span><span class="s">"DotNetSide Bari - Blazor"</span><span class="p">,</span> <span class="n">Localita</span><span class="p">=</span><span class="s">"Bari"</span><span class="p">,</span> <span class="n">Data</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">2020</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">21</span><span class="p">)}</span>
            <span class="p">};</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">CreaEvento</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">EventoCorrente</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Evento</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">ModificaEvento</span><span class="p">(</span><span class="n">ElementoListaEventi</span> <span class="n">evento</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">EventoCorrente</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Evento</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Id</span> <span class="p">=</span> <span class="n">evento</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
            <span class="n">Nome</span> <span class="p">=</span> <span class="n">evento</span><span class="p">.</span><span class="n">Nome</span><span class="p">,</span>
            <span class="n">Localita</span> <span class="p">=</span> <span class="n">evento</span><span class="p">.</span><span class="n">Localita</span><span class="p">,</span>
            <span class="n">Data</span> <span class="p">=</span> <span class="n">evento</span><span class="p">.</span><span class="n">Data</span>
        <span class="p">};</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">SalvaEvento</span><span class="p">(</span><span class="n">Evento</span> <span class="n">evento</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">evento</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">ListaEventi</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">ElementoListaEventi</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Id</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">ListaEventi</span><span class="p">.</span><span class="nf">Count</span><span class="p">()</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">?</span> <span class="k">this</span><span class="p">.</span><span class="n">ListaEventi</span><span class="p">.</span><span class="nf">Max</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span> <span class="p">+</span> <span class="m">1</span> <span class="p">:</span> <span class="m">1</span><span class="p">,</span>
                <span class="n">Nome</span> <span class="p">=</span> <span class="n">evento</span><span class="p">.</span><span class="n">Nome</span><span class="p">,</span>
                <span class="n">Localita</span> <span class="p">=</span> <span class="n">evento</span><span class="p">.</span><span class="n">Localita</span><span class="p">,</span>
                <span class="n">Data</span> <span class="p">=</span> <span class="n">evento</span><span class="p">.</span><span class="n">Data</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">eventoDaModificare</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">ListaEventi</span><span class="p">.</span><span class="nf">Single</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">evento</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
            <span class="n">eventoDaModificare</span><span class="p">.</span><span class="n">Nome</span> <span class="p">=</span> <span class="n">evento</span><span class="p">.</span><span class="n">Nome</span><span class="p">;</span>
            <span class="n">eventoDaModificare</span><span class="p">.</span><span class="n">Localita</span> <span class="p">=</span> <span class="n">evento</span><span class="p">.</span><span class="n">Localita</span><span class="p">;</span>
            <span class="n">eventoDaModificare</span><span class="p">.</span><span class="n">Data</span> <span class="p">=</span> <span class="n">evento</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="n">EventoCorrente</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">AnnullaOperazione</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">EventoCorrente</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">EliminaEvento</span><span class="p">(</span><span class="n">ElementoListaEventi</span> <span class="n">evento</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">ListaEventi</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">evento</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Ed ecco il risultato dei nostri sforzi:</p>

<p><img src="/assets/articoli/spa-gestione-form/blazor-inserimento-modifica-dati.gif" alt="Inserimento e modifica dati con le form di Blazor" title="Inserimento e modifica dati con le form di Blazor" /></p>

<h2 id="la-validazione-dei-dati">La validazione dei dati</h2>

<p>Guardando il modo in cui abbiamo utilizzato EditForm, notiamo che il submit della form è collegato al parametro OnSalva utilizzando un attributo denominato <code class="highlighter-rouge">OnValidSubmit</code>, che effettivamente invocherà la callback solo se la form è valida. Ma che significa valida? Questa è probabilmente uno dei più grossi vantaggi dell’utilizzo di Blazor: possiamo sfruttare le Data Annotations di .NET per definire le regole di validazione del nostro modello, lasciando ai componenti di Blazor l’onere di utilizzarle per verificare la validità dei dati ed eventualmente visualizzare gli errori.</p>

<p>Torniamo sulla classe Evento è aggiungiamo qualche annotazione per le validazioni:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Evento</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">Required</span><span class="p">(</span><span class="n">ErrorMessage</span><span class="p">=</span><span class="s">"Il nome è obbligatorio"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Nome</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">Required</span><span class="p">(</span><span class="n">ErrorMessage</span><span class="p">=</span><span class="s">"La località è obbligatoria"</span><span class="p">)]</span>
    <span class="p">[</span><span class="nf">StringLength</span><span class="p">(</span><span class="m">50</span><span class="p">,</span> <span class="n">ErrorMessage</span><span class="p">=</span><span class="s">"La lunghezza può essere al massimo di {1} caratteri"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Localita</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    
    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">Data</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Descrizione</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Note</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>A questo punto dobbiamo solo abilitare l’utilizzo delle Data Annotation nella form, utilizzando il componente <code class="highlighter-rouge">&lt;DataAnnotationsValidator /&gt;</code> e visualizzare l’elenco degli errori con il classico <code class="highlighter-rouge">&lt;ValidationSummary /&gt;</code> oppure uno specifico errore di validazione, ad esempio per la proprietà Nome, con <code class="highlighter-rouge">&lt;ValidationMessage For="@(() =&gt; DettaglioElemento.Nome)" /&gt;</code>:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;EditForm</span> <span class="na">Model=</span><span class="s">"@DettaglioElemento"</span> <span class="na">OnValidSubmit=</span><span class="s">"@(e =&gt; OnSalva.InvokeAsync(DettaglioElemento))"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;DataAnnotationsValidator</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;ValidationSummary</span> <span class="nt">/&gt;</span>
    
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"nome"</span><span class="nt">&gt;</span>Nome:<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;InputText</span> <span class="na">id=</span><span class="s">"nome"</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"DettaglioElemento.Nome"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;ValidationMessage</span> <span class="na">For=</span><span class="s">"@(() =&gt; DettaglioElemento.Nome)"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"localita"</span><span class="nt">&gt;</span>Località:<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;InputText</span> <span class="na">id=</span><span class="s">"localita"</span> <span class="err">@</span><span class="na">bind-Value=</span><span class="s">"DettaglioElemento.Localita"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;ValidationMessage</span> <span class="na">For=</span><span class="s">"@(() =&gt; DettaglioElemento.Localita)"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    ...
    
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Salva<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-warning"</span> <span class="err">@</span><span class="na">onclick=</span><span class="s">"OnAnnulla"</span><span class="nt">&gt;</span>Annulla<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/EditForm&gt;</span></code></pre></figure>

<p>Con queste semplici modifiche abbiamo una gestione completa delle validazioni:</p>

<p><img src="/assets/articoli/spa-gestione-form/blazor-validazione-dati.gif" alt="Validazione dati con le form di Blazor e le Data Annotations" title="Validazione dati con le form di Blazor e le Data Annotations" /></p>

<p>Potete consultare il codice descritto <a href="https://github.com/blazordevita/BlazorSPA">qui</a>, nella branch 05-gestione-form.</p>

<h2 id="conclusioni">Conclusioni</h2>

<p>Con questo articolo abbiamo ultimato la gestione della nostra prima CRUD con Blazor, utilizzando i componenti già pronti per l’inserimento dati e sfruttando le Data Annotations per la definizione delle regole di validazione. Per esigenze didattiche abbiamo lavorato con dei dati in memoria, ma nel prossimo articolo vedremo come possiamo facilmente inviare questi dati al back-end per poterli salvare in un repository persistente come un database.</p>

  </div><a class="u-url" href="/blazor/spa/2020/03/03/spa-gestione-form.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <h2 class="footer-heading">Blazor Developer Italiani</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Blazor Developer Italiani</li>
          <li>
            <a class="u-email" href="mailto:blazordevita@hotmail.com"
              >blazordevita@hotmail.com</a
            >
          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          <li>
            <a href="https://github.com/blazordevita"
              ><svg class="svg-icon">
                <use xlink:href="/assets/minima-social-icons.svg#github"></use>
              </svg>
              <span class="username">blazordevita</span></a
            >
          </li>
          <li>
            <a href="https://www.twitter.com/blazordevita"
              ><svg class="svg-icon">
                <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
              </svg>
              <span class="username">blazordevita</span></a
            >
          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <div id="mc_embed_signup">
            <form action="https://blazordev.us4.list-manage.com/subscribe/post?u=8f245a8c9245ef047e4b82346&amp;id=d5087d65ba" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                <div id="mc_embed_signup_scroll">
                <label for="mce-EMAIL">Newsletter:</label>&nbsp;
                <input type="email" style="width:150px" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="indirizzo email" required>
                <input type="submit" value="Iscriviti" name="subscribe" id="mc-embedded-subscribe" class="button">
                <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_8f245a8c9245ef047e4b82346_d5087d65ba" tabindex="-1" value=""></div>
                <div class="clear"></div>
                </div>
            </form>
        </div>
        <br />
        <p>
            La prima community italiana dedicata allo sviluppo di applicazioni con
            Blazor, il framework Microsoft per la realizzazione di Single Page
            Application con .NET Core, SignalR, WebAssembly e Razor
          </p>
      </div>
    </div>
  </div>
</footer>
</body>

</html>
